# nav2_params.yaml — GPS-only / dynamic localization (no static map)

# -------------------------------
# Map server (explicitly disabled)
# -------------------------------
map_server:
  ros__parameters:
    enabled: false
    yaml_filename: ""        
    frame_id: "map"
    topic_name: "map"
    use_sim_time: false

amcl:
  ros__parameters:
    enabled: false

# -------------------------------
# Lifecycle managers
# -------------------------------
lifecycle_manager_localization:
  ros__parameters:
    use_sim_time: false
    autostart: false         # DO NOT autostart localization manager (avoids configuring map_server)
    #node_names: []         # leave empty / default

lifecycle_manager_navigation:
  ros__parameters:
    use_sim_time: false
    autostart: true         # start navigation-related lifecycle nodes
    # Use default node_names; navigation manager will bring up controller/planner/costmaps/etc.

# -------------------------------
# Behaviour Tree / BT Navigator
# -------------------------------
bt_navigator:
  ros__parameters:
    use_sim_time: false
    default_bt_xml_filename: "navigate_to_pose_w_replanning_and_recovery.xml"
    enable_groot_monitoring: false
    plugin_lib_names:
      - nav2_behavior_tree::NavigateToPoseAction
      - nav2_behavior_tree::WaitAction
      - nav2_behavior_tree::ClearEntireCostmapService
      - nav2_behavior_tree::FollowPathAction
      - nav2_behavior_tree::BackUpAction

# -------------------------------
# Controller Server (Jazzy — explicit goal & progress checker blocks required)
# TODO: NATHAN make sure this server launches properly
# -------------------------------
controller_server:
  ros__parameters:
    use_sim_time: false
    controller_frequency: 10.0
    min_theta_velocity_threshold: 0.001

    # Jazzy requires explicit names for these plugins (exactly as used below)
    progress_checker_plugins: ["progress_checker"]
    goal_checker_plugins: ["goal_checker"]

    progress_checker:
      plugin: "nav2_controller::SimpleProgressChecker"

    goal_checker:
      plugin: "nav2_controller::SimpleGoalChecker"
      xy_goal_tolerance: 0.5
      yaw_goal_tolerance: 0.25

    controller_plugins: ["FollowPath"]

    FollowPath:
      plugin: "nav2_regulated_pure_pursuit_controller::RegulatedPurePursuitController"
      desired_linear_vel: 0.6
      lookahead_dist: 2.0
      min_lookahead_dist: 0.5
      max_lookahead_dist: 4.0
      use_velocity_scaled_lookahead_dist: true
      rotate_to_heading_angular_vel: 0.5
      transform_tolerance: 0.3
      allow_reversing: false
      use_interpolation: true
      use_rotate_to_heading: true
      max_angular_accel: 1.0
      min_approach_linear_velocity: 0.1
      goal_dist_tol: 0.5
      goal_yaw_tol: 0.25

# -------------------------------
# Planner Server
# -------------------------------
planner_server:
  ros__parameters:
    use_sim_time: false
    planner_frequency: 1.0
    expected_planner_frequency: 1.0
    tolerance: 2.0
    planner_plugins: ["GridBased"]

    GridBased:
      plugin: "nav2_navfn_planner/NavfnPlanner"
      use_astar: false
      allow_unknown: true

# -------------------------------
# Recovery Behaviors
# -------------------------------
recoveries_server:
  ros__parameters:
    costmap_clear_frequency: 1.0
    recovery_plugins: ["spin", "backup", "wait"]

    spin:
      plugin: "nav2_recoveries/Spin"
    backup:
      plugin: "nav2_recoveries/BackUp"
    wait:
      plugin: "nav2_recoveries/Wait"

# -------------------------------
# Waypoint Follower
# -------------------------------
waypoint_follower:
  ros__parameters:
    use_sim_time: false
    loop_rate: 5
    stop_on_failure: true
    interpolation_method: "linear"

# -------------------------------
# Global Costmap (no static map dependency)
# -------------------------------
global_costmap:
  ros__parameters:
    use_sim_time: false
    global_frame: map
    robot_base_frame: base_link
    update_frequency: 1.0
    publish_frequency: 1.0
    resolution: 0.5
    width: 80.0
    height: 80.0
    rolling_window: true
    always_send_full_costmap: true

    plugins: ["obstacle_layer", "inflation_layer"]

    obstacle_layer:
      plugin: "nav2_costmap_2d::ObstacleLayer"
      observation_sources: scan
      scan:
        topic: /scan
        sensor_frame: laser_frame
        data_type: LaserScan
        marking: true
        clearing: true
        obstacle_range: 10.0
        raytrace_range: 12.0
        min_obstacle_height: 0.0
        max_obstacle_height: 2.0

    inflation_layer:
      plugin: "nav2_costmap_2d::InflationLayer"
      cost_scaling_factor: 10.0
      inflation_radius: 0.6

# -------------------------------
# Local Costmap
# -------------------------------
local_costmap:
  ros__parameters:
    use_sim_time: false
    global_frame: odom
    robot_base_frame: base_link
    update_frequency: 5.0
    publish_frequency: 5.0
    rolling_window: true
    width: 10.0
    height: 10.0
    resolution: 0.05
    always_send_full_costmap: true

    plugins: ["obstacle_layer", "inflation_layer"]

    obstacle_layer:
      plugin: "nav2_costmap_2d::ObstacleLayer"
      observation_sources: scan
      scan:
        topic: /scan
        sensor_frame: laser_frame
        data_type: LaserScan
        marking: true
        clearing: true
        obstacle_range: 6.0
        raytrace_range: 8.0
        min_obstacle_height: 0.0
        max_obstacle_height: 2.0

    inflation_layer:
      plugin: "nav2_costmap_2d::InflationLayer"
      cost_scaling_factor: 10.0
      inflation_radius: 0.4

